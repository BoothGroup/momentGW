<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>momentGW.pbc.uhf package &#8212; momentGW  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="momentgw-pbc-uhf-package">
<h1>momentGW.pbc.uhf package<a class="headerlink" href="#momentgw-pbc-uhf-package" title="Link to this heading">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading">¶</a></h2>
</section>
<section id="module-momentGW.pbc.uhf.base">
<span id="momentgw-pbc-uhf-base-module"></span><h2>momentGW.pbc.uhf.base module<a class="headerlink" href="#module-momentGW.pbc.uhf.base" title="Link to this heading">¶</a></h2>
<p>Base class for moment-constrained GW solvers with periodic boundary
conditions and unrestricted references.</p>
<dl class="py class">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.base.BaseKUGW">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">momentGW.pbc.uhf.base.</span></span><span class="sig-name descname"><span class="pre">BaseKUGW</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mf</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.base.BaseKUGW" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="momentGW.pbc.html#momentGW.pbc.base.BaseKGW" title="momentGW.pbc.base.BaseKGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseKGW</span></code></a>, <a class="reference internal" href="momentGW.uhf.html#momentGW.uhf.base.BaseUGW" title="momentGW.uhf.base.BaseUGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseUGW</span></code></a></p>
<p>Base class for moment-constrained GW solvers for periodic systems
with unrestricted references.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mf</strong> (<em>pyscf.pbc.scf.KSCF</em>) – PySCF periodic mean-field class.</p></li>
<li><p><strong>diagonal_se</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, use a diagonal approximation in the self-energy.
Default value is <cite>False</cite>.</p></li>
<li><p><strong>polarizability</strong> (<em>str</em><em>, </em><em>optional</em>) – Type of polarizability to use, can be one of <cite>(“drpa”,
“drpa-exact”, “dtda”, “thc-dtda”). Default value is `”drpa”</cite>.</p></li>
<li><p><strong>npoints</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of numerical integration points. Default value is <cite>48</cite>.</p></li>
<li><p><strong>optimise_chempot</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, optimise the chemical potential by shifting the
position of the poles in the self-energy relative to those in
the Green’s function. Default value is <cite>False</cite>.</p></li>
<li><p><strong>fock_loop</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, self-consistently renormalise the density matrix
according to the updated Green’s function. Default value is
<cite>False</cite>.</p></li>
<li><p><strong>fock_opts</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary of options passed to the Fock loop. For more details
see <cite>momentGW.pbc.fock</cite>.</p></li>
<li><p><strong>compression</strong> (<em>str</em><em>, </em><em>optional</em>) – Blocks of the ERIs to use as a metric for compression. Can be
one or more of <cite>(“oo”, “ov”, “vv”, “ia”)</cite> which can be passed as
a comma-separated string. <cite>“oo”</cite>, <cite>“ov”</cite> and <cite>“vv”</cite> refer to
compression on the initial ERIs, whereas <cite>“ia”</cite> refers to
compression on the ERIs entering RPA, which may change under a
self-consistent scheme. Default value is <cite>“ia”</cite>.</p></li>
<li><p><strong>compression_tol</strong> (<em>float</em><em>, </em><em>optional</em>) – Tolerance for the compression. Default value is <cite>1e-10</cite>.</p></li>
<li><p><strong>thc_opts</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary of options to be used for THC calculations. Current
implementation requires a filepath to import the THC integrals.</p></li>
<li><p><strong>fc</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, apply finite size corrections. Default value is
<cite>False</cite>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-momentGW.pbc.uhf.evgw">
<span id="momentgw-pbc-uhf-evgw-module"></span><h2>momentGW.pbc.uhf.evgw module<a class="headerlink" href="#module-momentGW.pbc.uhf.evgw" title="Link to this heading">¶</a></h2>
<p>Spin-unrestricted eigenvalue self-consistent GW via self-energy moment
constraints for periodic systems.</p>
<dl class="py class">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.evgw.evKUGW">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">momentGW.pbc.uhf.evgw.</span></span><span class="sig-name descname"><span class="pre">evKUGW</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mf</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.evgw.evKUGW" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#momentGW.pbc.uhf.gw.KUGW" title="momentGW.pbc.uhf.gw.KUGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">KUGW</span></code></a>, <a class="reference internal" href="momentGW.pbc.html#momentGW.pbc.evgw.evKGW" title="momentGW.pbc.evgw.evKGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">evKGW</span></code></a>, <a class="reference internal" href="momentGW.uhf.html#momentGW.uhf.evgw.evUGW" title="momentGW.uhf.evgw.evUGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">evUGW</span></code></a></p>
<p>Spin-unrestricted eigenvalue self-consistent GW via self-energy
moment constraints for periodic systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mf</strong> (<em>pyscf.pbc.scf.KSCF</em>) – PySCF periodic mean-field class.</p></li>
<li><p><strong>diagonal_se</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, use a diagonal approximation in the self-energy.
Default value is <cite>False</cite>.</p></li>
<li><p><strong>polarizability</strong> (<em>str</em><em>, </em><em>optional</em>) – Type of polarizability to use, can be one of <cite>(“drpa”,
“drpa-exact”, “dtda”, “thc-dtda”). Default value is `”drpa”</cite>.</p></li>
<li><p><strong>npoints</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of numerical integration points. Default value is <cite>48</cite>.</p></li>
<li><p><strong>optimise_chempot</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, optimise the chemical potential by shifting the
position of the poles in the self-energy relative to those in
the Green’s function. Default value is <cite>False</cite>.</p></li>
<li><p><strong>fock_loop</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, self-consistently renormalise the density matrix
according to the updated Green’s function. Default value is
<cite>False</cite>.</p></li>
<li><p><strong>fock_opts</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary of options passed to the Fock loop. For more details
see <cite>momentGW.fock</cite>.</p></li>
<li><p><strong>compression</strong> (<em>str</em><em>, </em><em>optional</em>) – Blocks of the ERIs to use as a metric for compression. Can be
one or more of <cite>(“oo”, “ov”, “vv”, “ia”)</cite> which can be passed as
a comma-separated string. <cite>“oo”</cite>, <cite>“ov”</cite> and <cite>“vv”</cite> refer to
compression on the initial ERIs, whereas <cite>“ia”</cite> refers to
compression on the ERIs entering RPA, which may change under a
self-consistent scheme. Default value is <cite>“ia”</cite>.</p></li>
<li><p><strong>compression_tol</strong> (<em>float</em><em>, </em><em>optional</em>) – Tolerance for the compression. Default value is <cite>1e-10</cite>.</p></li>
<li><p><strong>thc_opts</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary of options to be used for THC calculations. Current
implementation requires a filepath to import the THC integrals.</p></li>
<li><p><strong>fc</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, apply finite size corrections. Default value is
<cite>False</cite>.</p></li>
<li><p><strong>g0</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, do not self-consistently update the eigenvalues in
the Green’s function. Default value is <cite>False</cite>.</p></li>
<li><p><strong>w0</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, do not self-consistently update the eigenvalues in
the screened Coulomb interaction. Default value is <cite>False</cite>.</p></li>
<li><p><strong>max_cycle</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum number of iterations. Default value is <cite>50</cite>.</p></li>
<li><p><strong>conv_tol</strong> (<em>float</em><em>, </em><em>optional</em>) – Convergence threshold in the change in the HOMO and LUMO.
Default value is <cite>1e-8</cite>.</p></li>
<li><p><strong>conv_tol_moms</strong> (<em>float</em><em>, </em><em>optional</em>) – Convergence threshold in the change in the moments. Default
value is <cite>1e-8</cite>.</p></li>
<li><p><strong>conv_logical</strong> (<em>callable</em><em>, </em><em>optional</em>) – Function that takes an iterable of booleans as input indicating
whether the individual <cite>conv_tol</cite> and <cite>conv_tol_moms</cite> have been
satisfied, respectively, and returns a boolean indicating
overall convergence. For example, the function <cite>all</cite> requires
both metrics to be met, and <cite>any</cite> requires just one. Default
value is <cite>all</cite>.</p></li>
<li><p><strong>diis_space</strong> (<em>int</em><em>, </em><em>optional</em>) – Size of the DIIS extrapolation space. Default value is <cite>8</cite>.</p></li>
<li><p><strong>damping</strong> (<em>float</em><em>, </em><em>optional</em>) – Damping parameter. Default value is <cite>0.0</cite>.</p></li>
<li><p><strong>weight_tol</strong> (<em>float</em><em>, </em><em>optional</em>) – Threshold in physical weight of Green’s function poles, below
which they are considered zero. Default value is <cite>1e-11</cite>.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.evgw.evKUGW.check_convergence">
<span class="sig-name descname"><span class="pre">check_convergence</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mo_energy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo_energy_prev</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">th</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">th_prev</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tp_prev</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.evgw.evKUGW.check_convergence" title="Link to this definition">¶</a></dt>
<dd><p>Check for convergence, and print a summary of changes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mo_energy</strong> (<em>numpy.ndarray</em>) – Molecular orbital energies at each k-point for each spin
channel.</p></li>
<li><p><strong>mo_energy_prev</strong> (<em>numpy.ndarray</em>) – Molecular orbital energies from the previous iteration at
each k-point for each spin channel.</p></li>
<li><p><strong>th</strong> (<em>numpy.ndarray</em>) – Moments of the occupied self-energy at each k-point for
each spin channel.</p></li>
<li><p><strong>th_prev</strong> (<em>numpy.ndarray</em>) – Moments of the occupied self-energy from the previous
iteration at each k-point for each spin channel.</p></li>
<li><p><strong>tp</strong> (<em>numpy.ndarray</em>) – Moments of the virtual self-energy at each k-point for each
spin channel.</p></li>
<li><p><strong>tp_prev</strong> (<em>numpy.ndarray</em>) – Moments of the virtual self-energy from the previous
iteration at each k-point for each spin channel.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>conv</strong> – Convergence flag.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.evgw.evKUGW.name">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">name</span></span><a class="headerlink" href="#momentGW.pbc.uhf.evgw.evKUGW.name" title="Link to this definition">¶</a></dt>
<dd><p>Get the method name.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.evgw.evKUGW.remove_unphysical_poles">
<span class="sig-name descname"><span class="pre">remove_unphysical_poles</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gf</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.evgw.evKUGW.remove_unphysical_poles" title="Link to this definition">¶</a></dt>
<dd><p>Remove unphysical poles from the Green’s function to stabilise
iterations, according to the threshold <cite>self.weight_tol</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>gf</strong> (<em>tuple</em><em> of </em><em>tuple</em><em> of </em><em>dyson.Lehmann</em>) – Green’s function at each k-point for each spin channel.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>gf_out</strong> – Green’s function at each k-point for each spin channel, with
potentially fewer poles.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of tuple of dyson.Lehmann</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-momentGW.pbc.uhf.fock">
<span id="momentgw-pbc-uhf-fock-module"></span><h2>momentGW.pbc.uhf.fock module<a class="headerlink" href="#module-momentGW.pbc.uhf.fock" title="Link to this heading">¶</a></h2>
<p>Fock matrix and static self-energy parts with periodic boundary
conditions and unrestricted references.</p>
<dl class="py class">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.fock.FockLoop">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">momentGW.pbc.uhf.fock.</span></span><span class="sig-name descname"><span class="pre">FockLoop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">se</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.fock.FockLoop" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="momentGW.pbc.html#momentGW.pbc.fock.FockLoop" title="momentGW.pbc.fock.FockLoop"><code class="xref py py-class docutils literal notranslate"><span class="pre">FockLoop</span></code></a></p>
<p>Self-consistent loop for the density matrix via the Hartree–Fock
self-consistent field for spin-unrestricted periodic systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gw</strong> (<a class="reference internal" href="#momentGW.pbc.uhf.base.BaseKUGW" title="momentGW.pbc.uhf.base.BaseKUGW"><em>BaseKUGW</em></a>) – GW object.</p></li>
<li><p><strong>gf</strong> (<em>tuple</em><em> of </em><em>tuple</em><em> of </em><em>dyson.Lehmann</em><em>, </em><em>optional</em>) – Initial Green’s function object at each k-point for each spin
channel. If <cite>None</cite>, use <cite>gw.init_gf()</cite>. Default value is <cite>None</cite>.</p></li>
<li><p><strong>se</strong> (<em>tuple</em><em> of </em><em>tuple</em><em> of </em><em>dyson.Lehmann</em><em>, </em><em>optional</em>) – Initial self-energy object at each k-point for each spin
channel. If passed, use as dynamic part of the self-energy. If
<cite>None</cite>, self-energy is assumed to be static and fully defined by
the Fock matrix. Default value is <cite>None</cite>.</p></li>
<li><p><strong>fock_diis_space</strong> (<em>int</em><em>, </em><em>optional</em>) – DIIS space size for the Fock matrix. Default value is <cite>10</cite>.</p></li>
<li><p><strong>fock_diis_min_space</strong> (<em>int</em><em>, </em><em>optional</em>) – Minimum DIIS space size for the Fock matrix. Default value is
<cite>1</cite>.</p></li>
<li><p><strong>conv_tol_nelec</strong> (<em>float</em><em>, </em><em>optional</em>) – Convergence tolerance for the number of electrons. Default
value is <cite>1e-6</cite>.</p></li>
<li><p><strong>conv_tol_rdm1</strong> (<em>float</em><em>, </em><em>optional</em>) – Convergence tolerance for the density matrix. Default value is
<cite>1e-8</cite>.</p></li>
<li><p><strong>max_cycle_inner</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum number of inner iterations. Default value is <cite>100</cite>.</p></li>
<li><p><strong>max_cycle_outer</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum number of outer iterations. Default value is <cite>20</cite>.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.fock.FockLoop.auxiliary_shift">
<span class="sig-name descname"><span class="pre">auxiliary_shift</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fock</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">se</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.fock.FockLoop.auxiliary_shift" title="Link to this definition">¶</a></dt>
<dd><p>Optimise a shift in the auxiliary energies to best satisfy the
electron number.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fock</strong> (<em>numpy.ndarray</em>) – Fock matrix at each k-point for each spin channel.</p></li>
<li><p><strong>se</strong> (<em>tuple</em><em> of </em><em>tuple</em><em> of </em><em>dyson.Lehmann</em><em>, </em><em>optional</em>) – Self-energy at each k-point for each spin channel. If
<cite>None</cite>, use <cite>self.se</cite>. Default value is <cite>None</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>se</strong> – Self-energy at each k-point for each spin channel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of tuple of dyson.Lehmann</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>If there is no dynamic part of the self-energy (<cite>self.se</cite> is
<cite>None</cite>), this method returns <cite>None</cite>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.fock.FockLoop.kernel">
<span class="sig-name descname"><span class="pre">kernel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">integrals</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.fock.FockLoop.kernel" title="Link to this definition">¶</a></dt>
<dd><p>Driver for the Fock loop.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>integrals</strong> (<a class="reference internal" href="#momentGW.pbc.uhf.ints.KUIntegrals" title="momentGW.pbc.uhf.ints.KUIntegrals"><em>KUIntegrals</em></a><em>, </em><em>optional</em>) – Integrals object. If <cite>None</cite>, generate from scratch. Default
value is <cite>None</cite>.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>converged</strong> (<em>bool</em>) – Whether the loop has converged.</p></li>
<li><p><strong>gf</strong> (<em>tuple of tuple of dyson.Lehmann</em>) – Green’s function object at each k-point for each spin
channel.</p></li>
<li><p><strong>se</strong> (<em>tuple of tuple of dyson.Lehmann</em>) – Self-energy object at each k-point for each spin channel.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.fock.FockLoop.naux">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">naux</span></span><a class="headerlink" href="#momentGW.pbc.uhf.fock.FockLoop.naux" title="Link to this definition">¶</a></dt>
<dd><p>Get the number of auxiliary states.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.fock.FockLoop.nelec">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">nelec</span></span><a class="headerlink" href="#momentGW.pbc.uhf.fock.FockLoop.nelec" title="Link to this definition">¶</a></dt>
<dd><p>Get the number of electrons.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.fock.FockLoop.nqmo">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">nqmo</span></span><a class="headerlink" href="#momentGW.pbc.uhf.fock.FockLoop.nqmo" title="Link to this definition">¶</a></dt>
<dd><p>Get the number of quasiparticle MOs.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.fock.FockLoop.search_chempot">
<span class="sig-name descname"><span class="pre">search_chempot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.fock.FockLoop.search_chempot" title="Link to this definition">¶</a></dt>
<dd><p>Search for a chemical potential for a given Green’s function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>gf</strong> (<em>tuple</em><em> of </em><em>dyson.Lehmann</em><em>, </em><em>optional</em>) – Green’s function for each spin channel. If <cite>None</cite>, use
<cite>self.gf</cite>. Default value is <cite>None</cite>.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>chempot</strong> (<em>tuple of float</em>) – Chemical potential for each spin channel.</p></li>
<li><p><strong>nerr</strong> (<em>tuple of float</em>) – Error in the number of electrons for each spin channel.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.fock.FockLoop.solve_dyson">
<span class="sig-name descname"><span class="pre">solve_dyson</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fock</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">se</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.fock.FockLoop.solve_dyson" title="Link to this definition">¶</a></dt>
<dd><p>Solve the Dyson equation for a given Fock matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fock</strong> (<em>numpy.ndarray</em>) – Fock matrix at each k-point for each spin channel.</p></li>
<li><p><strong>se</strong> (<em>tuple</em><em> of </em><em>dyson.Lehmann</em><em>, </em><em>optional</em>) – Self-energy at each k-point. If <cite>None</cite>, use <cite>self.se</cite>.
Default value is <cite>None</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>gf</strong> (<em>tuple of dyson.Lehmann</em>) – Green’s function at each k-point.</p></li>
<li><p><strong>nerr</strong> (<em>float</em>) – Error in the number of electrons.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>If there is no dynamic part of the self-energy (<cite>self.se</cite> is
<cite>None</cite>), this method simply diagonalises the Fock matrix and
returns the Lehmann representation of the resulting zeroth-order
Green’s function.</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-momentGW.pbc.uhf.fsgw">
<span id="momentgw-pbc-uhf-fsgw-module"></span><h2>momentGW.pbc.uhf.fsgw module<a class="headerlink" href="#module-momentGW.pbc.uhf.fsgw" title="Link to this heading">¶</a></h2>
<p>Spin-unrestricted Fock matrix self-consistent GW via self-energy moment
constraints for periodic systems.</p>
<dl class="py class">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.fsgw.fsKUGW">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">momentGW.pbc.uhf.fsgw.</span></span><span class="sig-name descname"><span class="pre">fsKUGW</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mf</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.fsgw.fsKUGW" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#momentGW.pbc.uhf.gw.KUGW" title="momentGW.pbc.uhf.gw.KUGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">KUGW</span></code></a>, <a class="reference internal" href="momentGW.pbc.html#momentGW.pbc.fsgw.fsKGW" title="momentGW.pbc.fsgw.fsKGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">fsKGW</span></code></a>, <a class="reference internal" href="momentGW.uhf.html#momentGW.uhf.fsgw.fsUGW" title="momentGW.uhf.fsgw.fsUGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">fsUGW</span></code></a></p>
<p>Spin-unrestricted Fock matrix self-consistent GW via self-energy
moment constraints for periodic systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mf</strong> (<em>pyscf.pbc.scf.KSCF</em>) – PySCF periodic mean-field class.</p></li>
<li><p><strong>diagonal_se</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, use a diagonal approximation in the self-energy.
Default value is <cite>False</cite>.</p></li>
<li><p><strong>polarizability</strong> (<em>str</em><em>, </em><em>optional</em>) – Type of polarizability to use, can be one of <cite>(“drpa”,
“drpa-exact”, “dtda”, “thc-dtda”). Default value is `”drpa”</cite>.</p></li>
<li><p><strong>npoints</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of numerical integration points. Default value is <cite>48</cite>.</p></li>
<li><p><strong>optimise_chempot</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, optimise the chemical potential by shifting the
position of the poles in the self-energy relative to those in
the Green’s function. Default value is <cite>False</cite>.</p></li>
<li><p><strong>fock_loop</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, self-consistently renormalise the density matrix
according to the updated Green’s function. Default value is
<cite>False</cite>.</p></li>
<li><p><strong>fock_opts</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary of options passed to the Fock loop. For more details
see <cite>momentGW.fock</cite>.</p></li>
<li><p><strong>compression</strong> (<em>str</em><em>, </em><em>optional</em>) – Blocks of the ERIs to use as a metric for compression. Can be
one or more of <cite>(“oo”, “ov”, “vv”, “ia”)</cite> which can be passed as
a comma-separated string. <cite>“oo”</cite>, <cite>“ov”</cite> and <cite>“vv”</cite> refer to
compression on the initial ERIs, whereas <cite>“ia”</cite> refers to
compression on the ERIs entering RPA, which may change under a
self-consistent scheme. Default value is <cite>“ia”</cite>.</p></li>
<li><p><strong>compression_tol</strong> (<em>float</em><em>, </em><em>optional</em>) – Tolerance for the compression. Default value is <cite>1e-10</cite>.</p></li>
<li><p><strong>thc_opts</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary of options to be used for THC calculations. Current
implementation requires a filepath to import the THC integrals.</p></li>
<li><p><strong>fc</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, apply finite size corrections. Default value is
<cite>False</cite>.</p></li>
<li><p><strong>max_cycle</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum number of iterations. Default value is <cite>50</cite>.</p></li>
<li><p><strong>conv_tol</strong> (<em>float</em><em>, </em><em>optional</em>) – Convergence threshold in the change in the HOMO and LUMO.
Default value is <cite>1e-8</cite>.</p></li>
<li><p><strong>conv_tol_moms</strong> (<em>float</em><em>, </em><em>optional</em>) – Convergence threshold in the change in the moments. Default
value is <cite>1e-8</cite>.</p></li>
<li><p><strong>conv_logical</strong> (<em>callable</em><em>, </em><em>optional</em>) – Function that takes an iterable of booleans as input indicating
whether the individual <cite>conv_tol</cite>, <cite>conv_tol_moms</cite> have been
satisfied, respectively, and returns a boolean indicating
overall convergence. For example, the function <cite>all</cite> requires
both metrics to be met, and <cite>any</cite> requires just one. Default
value is <cite>all</cite>.</p></li>
<li><p><strong>diis_space</strong> (<em>int</em><em>, </em><em>optional</em>) – Size of the DIIS extrapolation space. Default value is <cite>8</cite>.</p></li>
<li><p><strong>damping</strong> (<em>float</em><em>, </em><em>optional</em>) – Damping parameter. Default value is <cite>0.0</cite>.</p></li>
<li><p><strong>solver</strong> (<a class="reference internal" href="momentGW.html#momentGW.base.BaseGW" title="momentGW.base.BaseGW"><em>BaseGW</em></a><em>, </em><em>optional</em>) – Solver to use to obtain the self-energy. Compatible with any
<cite>BaseGW</cite>-like class. Default value is <cite>momentGW.gw.GW</cite>.</p></li>
<li><p><strong>solver_options</strong> (<em>dict</em><em>, </em><em>optional</em>) – Keyword arguments to pass to the solver. Default value is an
empty <cite>dict</cite>.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.fsgw.fsKUGW.check_convergence">
<span class="sig-name descname"><span class="pre">check_convergence</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mo_energy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo_energy_prev</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">th</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">th_prev</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tp_prev</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.fsgw.fsKUGW.check_convergence" title="Link to this definition">¶</a></dt>
<dd><p>Check for convergence, and print a summary of changes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mo_energy</strong> (<em>numpy.ndarray</em>) – Molecular orbital energies at each k-point for each spin
channel.</p></li>
<li><p><strong>mo_energy_prev</strong> (<em>numpy.ndarray</em>) – Molecular orbital energies from the previous iteration at
each k-point for each spin channel.</p></li>
<li><p><strong>th</strong> (<em>numpy.ndarray</em>) – Moments of the occupied self-energy at each k-point for
each spin channel.</p></li>
<li><p><strong>th_prev</strong> (<em>numpy.ndarray</em>) – Moments of the occupied self-energy from the previous
iteration at each k-point for each spin channel.</p></li>
<li><p><strong>tp</strong> (<em>numpy.ndarray</em>) – Moments of the virtual self-energy at each k-point for each
spin channel.</p></li>
<li><p><strong>tp_prev</strong> (<em>numpy.ndarray</em>) – Moments of the virtual self-energy from the previous
iteration at each k-point for each spin channel.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>conv</strong> – Convergence flag.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.fsgw.fsKUGW.name">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">name</span></span><a class="headerlink" href="#momentGW.pbc.uhf.fsgw.fsKUGW.name" title="Link to this definition">¶</a></dt>
<dd><p>Get the method name.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.fsgw.fsKUGW.project_basis">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">project_basis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ovlp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.fsgw.fsKUGW.project_basis" title="Link to this definition">¶</a></dt>
<dd><p>Project a matrix from one basis to another.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>matrix</strong> (<em>numpy.ndarray</em><em> or </em><em>tuple</em><em> of </em><em>dyson.Lehmann</em>) – Matrix to project at each k-point for each spin channel. Can
also be a tuple of <cite>dyson.Lehmann</cite> objects, in which case the
<cite>couplings</cite> attributes are projected.</p></li>
<li><p><strong>ovlp</strong> (<em>numpy.ndarray</em>) – Overlap matrix in the shared (AO) basis at each k-point.</p></li>
<li><p><strong>mo1</strong> (<em>numpy.ndarray</em>) – First basis, rotates from the shared (AO) basis into the
basis of <cite>matrix</cite> at each k-point for each spin channel.</p></li>
<li><p><strong>mo2</strong> (<em>numpy.ndarray</em>) – Second basis, rotates from the shared (AO) basis into the
desired basis of the output at each k-point for each spin
channel.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>proj</strong> – Matrix projected into the desired basis at each k-point
for each spin channel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray or tuple of dyson.Lehmann</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.fsgw.fsKUGW.self_energy_to_moments">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">self_energy_to_moments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">se</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nmom_max</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.fsgw.fsKUGW.self_energy_to_moments" title="Link to this definition">¶</a></dt>
<dd><p>Return the hole and particle moments for a self-energy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>se</strong> (<em>tuple</em><em> of </em><em>dyson.Lehmann</em>) – Self-energy to compute the moments of at each k-point
for each spin channel.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>th</strong> (<em>numpy.ndarray</em>) – Hole moments at each k-point for each spin channel.</p></li>
<li><p><strong>tp</strong> (<em>numpy.ndarray</em>) – Particle moments at each k-point for each spin channel.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.fsgw.fsKUGW.solver">
<span class="sig-name descname"><span class="pre">solver</span></span><a class="headerlink" href="#momentGW.pbc.uhf.fsgw.fsKUGW.solver" title="Link to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#momentGW.pbc.uhf.gw.KUGW" title="momentGW.pbc.uhf.gw.KUGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">KUGW</span></code></a></p>
</dd></dl>

</dd></dl>

</section>
<section id="module-momentGW.pbc.uhf.gw">
<span id="momentgw-pbc-uhf-gw-module"></span><h2>momentGW.pbc.uhf.gw module<a class="headerlink" href="#module-momentGW.pbc.uhf.gw" title="Link to this heading">¶</a></h2>
<p>Spin-unrestricted one-shot GW via self-energy moment constraints for
periodic systems.</p>
<dl class="py class">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.gw.KUGW">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">momentGW.pbc.uhf.gw.</span></span><span class="sig-name descname"><span class="pre">KUGW</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mf</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.gw.KUGW" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#momentGW.pbc.uhf.base.BaseKUGW" title="momentGW.pbc.uhf.base.BaseKUGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseKUGW</span></code></a>, <a class="reference internal" href="momentGW.pbc.html#momentGW.pbc.gw.KGW" title="momentGW.pbc.gw.KGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">KGW</span></code></a>, <a class="reference internal" href="momentGW.uhf.html#momentGW.uhf.gw.UGW" title="momentGW.uhf.gw.UGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">UGW</span></code></a></p>
<p>Spin-unrestricted one-shot GW via self-energy moment constraints for
periodic systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mf</strong> (<em>pyscf.pbc.scf.KSCF</em>) – PySCF periodic mean-field class.</p></li>
<li><p><strong>diagonal_se</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, use a diagonal approximation in the self-energy.
Default value is <cite>False</cite>.</p></li>
<li><p><strong>polarizability</strong> (<em>str</em><em>, </em><em>optional</em>) – Type of polarizability to use, can be one of <cite>(“drpa”,
“drpa-exact”, “dtda”, “thc-dtda”). Default value is `”drpa”</cite>.</p></li>
<li><p><strong>npoints</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of numerical integration points. Default value is <cite>48</cite>.</p></li>
<li><p><strong>optimise_chempot</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, optimise the chemical potential by shifting the
position of the poles in the self-energy relative to those in
the Green’s function. Default value is <cite>False</cite>.</p></li>
<li><p><strong>fock_loop</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, self-consistently renormalise the density matrix
according to the updated Green’s function. Default value is
<cite>False</cite>.</p></li>
<li><p><strong>fock_opts</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary of options passed to the Fock loop. For more details
see <cite>momentGW.pbc.fock</cite>.</p></li>
<li><p><strong>compression</strong> (<em>str</em><em>, </em><em>optional</em>) – Blocks of the ERIs to use as a metric for compression. Can be
one or more of <cite>(“oo”, “ov”, “vv”, “ia”)</cite> which can be passed as
a comma-separated string. <cite>“oo”</cite>, <cite>“ov”</cite> and <cite>“vv”</cite> refer to
compression on the initial ERIs, whereas <cite>“ia”</cite> refers to
compression on the ERIs entering RPA, which may change under a
self-consistent scheme. Default value is <cite>“ia”</cite>.</p></li>
<li><p><strong>compression_tol</strong> (<em>float</em><em>, </em><em>optional</em>) – Tolerance for the compression. Default value is <cite>1e-10</cite>.</p></li>
<li><p><strong>thc_opts</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary of options to be used for THC calculations. Current
implementation requires a filepath to import the THC integrals.</p></li>
<li><p><strong>fc</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, apply finite size corrections. Default value is
<cite>False</cite>.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.gw.KUGW.ao2mo">
<span class="sig-name descname"><span class="pre">ao2mo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.gw.KUGW.ao2mo" title="Link to this definition">¶</a></dt>
<dd><p>Get the integrals object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>transform</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to transform the integrals object.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>integrals</strong> – Integrals object.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#momentGW.pbc.uhf.ints.KUIntegrals" title="momentGW.pbc.uhf.ints.KUIntegrals">KUIntegrals</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.gw.KUGW.build_se_moments">
<span class="sig-name descname"><span class="pre">build_se_moments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nmom_max</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">integrals</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.gw.KUGW.build_se_moments" title="Link to this definition">¶</a></dt>
<dd><p>Build the moments of the self-energy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nmom_max</strong> (<em>int</em>) – Maximum moment number to calculate.</p></li>
<li><p><strong>integrals</strong> (<a class="reference internal" href="#momentGW.pbc.uhf.ints.KUIntegrals" title="momentGW.pbc.uhf.ints.KUIntegrals"><em>KUIntegrals</em></a>) – Density-fitted integrals.</p></li>
<li><p><strong>options.</strong> (<em>See functions in momentGW.rpa for kwargs</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>se_moments_hole</strong> (<em>numpy.ndarray</em>) – Moments of the hole self-energy at each k-point for each
spin channel. If <cite>self.diagonal_se</cite>, non-diagonal elements
are set to zero.</p></li>
<li><p><strong>se_moments_part</strong> (<em>numpy.ndarray</em>) – Moments of the particle self-energy at each k-point for each
spin channel. If <cite>self.diagonal_se</cite>, non-diagonal elements
are set to zero.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.gw.KUGW.build_se_static">
<span class="sig-name descname"><span class="pre">build_se_static</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">integrals</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.gw.KUGW.build_se_static" title="Link to this definition">¶</a></dt>
<dd><p>Build the static part of the self-energy, including the Fock
matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>integrals</strong> (<a class="reference internal" href="#momentGW.pbc.uhf.ints.KUIntegrals" title="momentGW.pbc.uhf.ints.KUIntegrals"><em>KUIntegrals</em></a>) – Integrals object.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>se_static</strong> – Static part of the self-energy at each k-point for each spin
channel. If <cite>self.diagonal_se</cite>, non-diagonal elements are
set to zero.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.gw.KUGW.energy_gm">
<span class="sig-name descname"><span class="pre">energy_gm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">se</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g0</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.gw.KUGW.energy_gm" title="Link to this definition">¶</a></dt>
<dd><p>Calculate the two-body (Galitskii–Migdal) energy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gf</strong> (<em>tuple</em><em> of </em><em>tuple</em><em> of </em><em>dyson.Lehmann</em><em>, </em><em>optional</em>) – Green’s function at each k-point for each spin channel. If
<cite>None</cite>, use <cite>self.gf</cite>. Default value is <cite>None</cite>.</p></li>
<li><p><strong>se</strong> (<em>tuple</em><em> of </em><em>tuple</em><em> of </em><em>dyson.Lehmann</em><em>, </em><em>optional</em>) – Self-energy at each k-point for each spin channel. If
<cite>None</cite>, use <cite>self.se</cite>. Default value is <cite>None</cite>.</p></li>
<li><p><strong>g0</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, use the mean-field Green’s function. Default
value is <cite>True</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>e_2b</strong> – Two-body energy.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>With <cite>g0=False</cite>, this function scales as
<span class="math notranslate nohighlight">\(\mathcal{O}(N^4)\)</span> with system size, whereas with
<cite>g0=True</cite>, it scales as <span class="math notranslate nohighlight">\(\mathcal{O}(N^3)\)</span>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.gw.KUGW.energy_hf">
<span class="sig-name descname"><span class="pre">energy_hf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">integrals</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.gw.KUGW.energy_hf" title="Link to this definition">¶</a></dt>
<dd><p>Calculate the one-body (Hartree–Fock) energy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gf</strong> (<em>tuple</em><em> of </em><em>dyson.Lehmann</em><em>, </em><em>optional</em>) – Green’s function at each k-point for each spin channel. If
<cite>None</cite>, use either <cite>self.gf</cite>, or the mean-field Green’s
function. Default value is <cite>None</cite>.</p></li>
<li><p><strong>integrals</strong> (<a class="reference internal" href="#momentGW.pbc.uhf.ints.KUIntegrals" title="momentGW.pbc.uhf.ints.KUIntegrals"><em>KUIntegrals</em></a><em>, </em><em>optional</em>) – Integrals object. If <cite>None</cite>, generate from scratch. Default
value is <cite>None</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>e_1b</strong> – One-body energy.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.gw.KUGW.init_gf">
<span class="sig-name descname"><span class="pre">init_gf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mo_energy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.gw.KUGW.init_gf" title="Link to this definition">¶</a></dt>
<dd><p>Initialise the mean-field Green’s function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>mo_energy</strong> (<em>numpy.ndarray</em><em>, </em><em>optional</em>) – Molecular orbital energies at each k-point for each spin
channel. Default value is <cite>self.mo_energy</cite>.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>gf</strong> – Mean-field Green’s function at each k-point for each spin
channel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of tuple of dyson.Lehmann</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.gw.KUGW.interpolate">
<span class="sig-name descname"><span class="pre">interpolate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nmom_max</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.gw.KUGW.interpolate" title="Link to this definition">¶</a></dt>
<dd><p>Interpolate the object to a new k-point grid, represented by a
new mean-field object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mf</strong> (<em>pyscf.pbc.scf.KSCF</em>) – Mean-field object on new k-point mesh.</p></li>
<li><p><strong>nmom_max</strong> (<em>int</em>) – Maximum moment number to calculate.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>other</strong> – Interpolated object.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>__class__</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.gw.KUGW.kernel">
<span class="sig-name descname"><span class="pre">kernel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nmom_max</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">moments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">integrals</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.gw.KUGW.kernel" title="Link to this definition">¶</a></dt>
<dd><p>Driver for the method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nmom_max</strong> (<em>int</em>) – Maximum moment number to calculate.</p></li>
<li><p><strong>moments</strong> (<em>tuple</em><em> of </em><em>numpy.ndarray</em><em>, </em><em>optional</em>) – Tuple of (hole, particle) moments at each k-point for each
spin channel, if passed then they will be used instead of
calculating them. Default value is <cite>None</cite>.</p></li>
<li><p><strong>integrals</strong> (<a class="reference internal" href="#momentGW.pbc.uhf.ints.KUIntegrals" title="momentGW.pbc.uhf.ints.KUIntegrals"><em>KUIntegrals</em></a><em>, </em><em>optional</em>) – Integrals object. If <cite>None</cite>, generate from scratch. Default
value is <cite>None</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>converged</strong> (<em>bool</em>) – Whether the solver converged. For single-shot calculations,
this is always <cite>True</cite>.</p></li>
<li><p><strong>gf</strong> (<em>tuple of tuple of dyson.Lehmann</em>) – Green’s function object at each k-point for each spin
channel.</p></li>
<li><p><strong>se</strong> (<em>tuple of tuple of dyson.Lehmann</em>) – Self-energy object at each k-point for each spin channel.</p></li>
<li><p><strong>qp_energy</strong> (<em>NoneType</em>) – Quasiparticle energies. For most GW methods, this is <cite>None</cite>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.gw.KUGW.make_rdm1">
<span class="sig-name descname"><span class="pre">make_rdm1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.gw.KUGW.make_rdm1" title="Link to this definition">¶</a></dt>
<dd><p>Get the first-order reduced density matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>gf</strong> (<em>tuple</em><em> of </em><em>tuple</em><em> of </em><em>dyson.Lehmann</em><em>, </em><em>optional</em>) – Green’s function at each k-point for each spin channel. If
<cite>None</cite>, use either <cite>self.gf</cite>, or the mean-field Green’s
function. Default value is <cite>None</cite>.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>rdm1</strong> – First-order reduced density matrix at each k-point for each
spin channel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.gw.KUGW.name">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">name</span></span><a class="headerlink" href="#momentGW.pbc.uhf.gw.KUGW.name" title="Link to this definition">¶</a></dt>
<dd><p>Get the method name.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.gw.KUGW.solve_dyson">
<span class="sig-name descname"><span class="pre">solve_dyson</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">se_moments_hole</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">se_moments_part</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">se_static</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">integrals</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.gw.KUGW.solve_dyson" title="Link to this definition">¶</a></dt>
<dd><p>Solve the Dyson equation due to a self-energy resulting
from a list of hole and particle moments, along with a static
contribution.</p>
<p>Also finds a chemical potential best satisfying the physical
number of electrons. If <cite>self.optimise_chempot</cite>, this will
shift the self-energy poles relative to the Green’s function,
which is a partial self-consistency that better conserves the
particle number.</p>
<p>If <cite>self.fock_loop</cite>, this function will also require that the
outputted Green’s function is self-consistent with respect to
the corresponding density and Fock matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>se_moments_hole</strong> (<em>numpy.ndarray</em>) – Moments of the hole self-energy at each k-point for each
spin channel.</p></li>
<li><p><strong>se_moments_part</strong> (<em>numpy.ndarray</em>) – Moments of the particle self-energy at each k-point for
each spin channel.</p></li>
<li><p><strong>se_static</strong> (<em>numpy.ndarray</em>) – Static part of the self-energy at each k-point for each
spin channel.</p></li>
<li><p><strong>integrals</strong> (<a class="reference internal" href="#momentGW.pbc.uhf.ints.KUIntegrals" title="momentGW.pbc.uhf.ints.KUIntegrals"><em>KUIntegrals</em></a><em>, </em><em>optional</em>) – Density-fitted integrals. Required if <cite>self.fock_loop</cite>
is <cite>True</cite>. Default value is <cite>None</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>gf</strong> (<em>list of list of dyson.Lehmann</em>) – Green’s function at each k-point for each spin channel.</p></li>
<li><p><strong>se</strong> (<em>list of list of dyson.Lehmann</em>) – Self-energy at each k-point for each spin channel.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-momentGW.pbc.uhf.ints">
<span id="momentgw-pbc-uhf-ints-module"></span><h2>momentGW.pbc.uhf.ints module<a class="headerlink" href="#module-momentGW.pbc.uhf.ints" title="Link to this heading">¶</a></h2>
<p>Integral helpers with periodic boundary conditions and unrestricted
reference.</p>
<dl class="py class">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.ints.KUIntegrals">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">momentGW.pbc.uhf.ints.</span></span><span class="sig-name descname"><span class="pre">KUIntegrals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">with_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kpts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo_coeff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo_occ</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compression</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ia'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compression_tol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">store_full</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.ints.KUIntegrals" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="momentGW.uhf.html#momentGW.uhf.ints.UIntegrals" title="momentGW.uhf.ints.UIntegrals"><code class="xref py py-class docutils literal notranslate"><span class="pre">UIntegrals</span></code></a>, <a class="reference internal" href="momentGW.pbc.html#momentGW.pbc.ints.KIntegrals" title="momentGW.pbc.ints.KIntegrals"><code class="xref py py-class docutils literal notranslate"><span class="pre">KIntegrals</span></code></a></p>
<p>Container for the density-fitted integrals required for KUGW
methods.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>with_df</strong> (<em>pyscf.pbc.df.DF</em>) – Density fitting object.</p></li>
<li><p><strong>mo_coeff</strong> (<em>numpy.ndarray</em>) – Molecular orbital coefficients at each k-point for each spin
channel.</p></li>
<li><p><strong>mo_occ</strong> (<em>numpy.ndarray</em>) – Molecular orbital occupations at each k-point for each spin
channel.</p></li>
<li><p><strong>compression</strong> (<em>str</em><em>, </em><em>optional</em>) – Compression scheme to use. Default value is <cite>‘ia’</cite>. See
<cite>momentGW.gw</cite> for more details.</p></li>
<li><p><strong>compression_tol</strong> (<em>float</em><em>, </em><em>optional</em>) – Compression tolerance. Default value is <cite>1e-10</cite>. See
<cite>momentGW.gw</cite> for more details.</p></li>
<li><p><strong>store_full</strong> (<em>bool</em><em>, </em><em>optional</em>) – Store the full MO integrals in memory. Default value is
<cite>False</cite>.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.ints.KUIntegrals.get_compression_metric">
<span class="sig-name descname"><span class="pre">get_compression_metric</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.ints.KUIntegrals.get_compression_metric" title="Link to this definition">¶</a></dt>
<dd><p>Return the compression metric.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>rot</strong> – Rotation matrix into the compressed auxiliary space.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.ints.KUIntegrals.get_fock">
<span class="sig-name descname"><span class="pre">get_fock</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h1e</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.ints.KUIntegrals.get_fock" title="Link to this definition">¶</a></dt>
<dd><p>Build the Fock matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dm</strong> (<em>numpy.ndarray</em>) – Density matrix at each k-point for each spin channel.</p></li>
<li><p><strong>h1e</strong> (<em>numpy.ndarray</em>) – Core Hamiltonian matrix at each k-point for each spin
channel.</p></li>
<li><p><strong>**kwargs</strong> (<em>dict</em><em>, </em><em>optional</em>) – Additional keyword arguments for <cite>get_jk</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>fock</strong> – Fock matrix at each k-point for each spin channel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>See <cite>get_jk</cite> for more information. The basis of <cite>h1e</cite> must be
the same as <cite>dm</cite>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.ints.KUIntegrals.get_j">
<span class="sig-name descname"><span class="pre">get_j</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">basis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mo'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.ints.KUIntegrals.get_j" title="Link to this definition">¶</a></dt>
<dd><p>Build the J matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dm</strong> (<em>numpy.ndarray</em>) – Density matrix at each k-point for each spin channel.</p></li>
<li><p><strong>basis</strong> (<em>str</em><em>, </em><em>optional</em>) – Basis in which to build the J matrix. One of
<cite>(“ao”, “mo”)</cite>. Default value is <cite>“mo”</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>vj</strong> – J matrix at each k-point for each spin channel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.ints.KUIntegrals.get_jk">
<span class="sig-name descname"><span class="pre">get_jk</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dm</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.ints.KUIntegrals.get_jk" title="Link to this definition">¶</a></dt>
<dd><p>Build the J and K matrices.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>vj</strong> (<em>numpy.ndarray</em>) – J matrix at each k-point for each spin channel.</p></li>
<li><p><strong>vk</strong> (<em>numpy.ndarray</em>) – K matrix at each k-point for each spin channel.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>See <cite>get_j</cite> and <cite>get_k</cite> for more information.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.ints.KUIntegrals.get_k">
<span class="sig-name descname"><span class="pre">get_k</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">basis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mo'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.ints.KUIntegrals.get_k" title="Link to this definition">¶</a></dt>
<dd><p>Build the K matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dm</strong> (<em>numpy.ndarray</em>) – Density matrix at each k-point for each spin channel.</p></li>
<li><p><strong>basis</strong> (<em>str</em><em>, </em><em>optional</em>) – Basis in which to build the K matrix. One of
<cite>(“ao”, “mo”)</cite>. Default value is <cite>“mo”</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>vk</strong> – K matrix for each spin channel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.ints.KUIntegrals.get_veff">
<span class="sig-name descname"><span class="pre">get_veff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">j</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.ints.KUIntegrals.get_veff" title="Link to this definition">¶</a></dt>
<dd><p>Build the effective potential.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dm</strong> (<em>numpy.ndarray</em>) – Density matrix at each k-point for each spin channel.</p></li>
<li><p><strong>j</strong> (<em>numpy.ndarray</em><em>, </em><em>optional</em>) – J matrix at each k-point for each spin channel. If <cite>None</cite>,
compute it. Default value is <cite>None</cite>.</p></li>
<li><p><strong>k</strong> (<em>numpy.ndarray</em><em>, </em><em>optional</em>) – K matrix at each k-point for each spin channel. If <cite>None</cite>,
compute it. Default value is <cite>None</cite>.</p></li>
<li><p><strong>**kwargs</strong> (<em>dict</em><em>, </em><em>optional</em>) – Additional keyword arguments for <cite>get_jk</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>veff</strong> – Effective potential at each k-point for each spin channel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>See <cite>get_jk</cite> for more information.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.ints.KUIntegrals.update_coeffs">
<span class="sig-name descname"><span class="pre">update_coeffs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mo_coeff_g</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo_coeff_w</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo_occ_w</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.ints.KUIntegrals.update_coeffs" title="Link to this definition">¶</a></dt>
<dd><p>Update the MO coefficients for the Green’s function and the
screened Coulomb interaction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mo_coeff_g</strong> (<em>numpy.ndarray</em><em>, </em><em>optional</em>) – Coefficients corresponding to the Green’s function at each
k-point for each spin channel. Default value is <cite>None</cite>.</p></li>
<li><p><strong>mo_coeff_w</strong> (<em>numpy.ndarray</em><em>, </em><em>optional</em>) – Coefficients corresponding to the screened Coulomb
interaction at each k-point for each spin channel. Default
value is <cite>None</cite>.</p></li>
<li><p><strong>mo_occ_w</strong> (<em>numpy.ndarray</em><em>, </em><em>optional</em>) – Occupations corresponding to the screened Coulomb
interaction at each k-point for each spin channel. Default
value is <cite>None</cite>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>If <cite>mo_coeff_g</cite> is <cite>None</cite>, the Green’s function is assumed to
remain in the basis in which it was originally defined, and
vice-versa for <cite>mo_coeff_w</cite> and <cite>mo_occ_w</cite>. At least one of
<cite>mo_coeff_g</cite> and <cite>mo_coeff_w</cite> must be provided.</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-momentGW.pbc.uhf.qsgw">
<span id="momentgw-pbc-uhf-qsgw-module"></span><h2>momentGW.pbc.uhf.qsgw module<a class="headerlink" href="#module-momentGW.pbc.uhf.qsgw" title="Link to this heading">¶</a></h2>
<p>Spin-unrestricted quasiparticle self-consistent GW via self-energy
moment constraints for periodic systems.</p>
<dl class="py class">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.qsgw.qsKUGW">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">momentGW.pbc.uhf.qsgw.</span></span><span class="sig-name descname"><span class="pre">qsKUGW</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mf</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.qsgw.qsKUGW" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#momentGW.pbc.uhf.gw.KUGW" title="momentGW.pbc.uhf.gw.KUGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">KUGW</span></code></a>, <a class="reference internal" href="momentGW.pbc.html#momentGW.pbc.qsgw.qsKGW" title="momentGW.pbc.qsgw.qsKGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">qsKGW</span></code></a>, <a class="reference internal" href="momentGW.uhf.html#momentGW.uhf.qsgw.qsUGW" title="momentGW.uhf.qsgw.qsUGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">qsUGW</span></code></a></p>
<p>Spin-unrestricted quasiparticle self-consistent GW via self-energy
moment constraints for periodic systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mf</strong> (<em>pyscf.pbc.scf.KSCF</em>) – PySCF periodic mean-field class.</p></li>
<li><p><strong>diagonal_se</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, use a diagonal approximation in the self-energy.
Default value is <cite>False</cite>.</p></li>
<li><p><strong>polarizability</strong> (<em>str</em><em>, </em><em>optional</em>) – Type of polarizability to use, can be one of <cite>(“drpa”,
“drpa-exact”, “dtda”, “thc-dtda”). Default value is `”drpa”</cite>.</p></li>
<li><p><strong>npoints</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of numerical integration points. Default value is <cite>48</cite>.</p></li>
<li><p><strong>optimise_chempot</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, optimise the chemical potential by shifting the
position of the poles in the self-energy relative to those in
the Green’s function. Default value is <cite>False</cite>.</p></li>
<li><p><strong>fock_loop</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, self-consistently renormalise the density matrix
according to the updated Green’s function. Default value is
<cite>False</cite>.</p></li>
<li><p><strong>fock_opts</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary of options passed to the Fock loop. For more details
see <cite>momentGW.fock</cite>.</p></li>
<li><p><strong>compression</strong> (<em>str</em><em>, </em><em>optional</em>) – Blocks of the ERIs to use as a metric for compression. Can be
one or more of <cite>(“oo”, “ov”, “vv”, “ia”)</cite> which can be passed as
a comma-separated string. <cite>“oo”</cite>, <cite>“ov”</cite> and <cite>“vv”</cite> refer to
compression on the initial ERIs, whereas <cite>“ia”</cite> refers to
compression on the ERIs entering RPA, which may change under a
self-consistent scheme. Default value is <cite>“ia”</cite>.</p></li>
<li><p><strong>compression_tol</strong> (<em>float</em><em>, </em><em>optional</em>) – Tolerance for the compression. Default value is <cite>1e-10</cite>.</p></li>
<li><p><strong>thc_opts</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary of options to be used for THC calculations. Current
implementation requires a filepath to import the THC integrals.</p></li>
<li><p><strong>fc</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, apply finite size corrections. Default value is
<cite>False</cite>.</p></li>
<li><p><strong>max_cycle</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum number of iterations. Default value is <cite>50</cite>.</p></li>
<li><p><strong>max_cycle_qp</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum number of iterations in the quasiparticle equation
loop. Default value is <cite>50</cite>.</p></li>
<li><p><strong>conv_tol</strong> (<em>float</em><em>, </em><em>optional</em>) – Convergence threshold in the change in the HOMO and LUMO.
Default value is <cite>1e-8</cite>.</p></li>
<li><p><strong>conv_tol_moms</strong> (<em>float</em><em>, </em><em>optional</em>) – Convergence threshold in the change in the moments. Default
value is <cite>1e-8</cite>.</p></li>
<li><p><strong>conv_tol_qp</strong> (<em>float</em><em>, </em><em>optional</em>) – Convergence threshold in the change in the density matrix in
the quasiparticle equation loop. Default value is <cite>1e-8</cite>.</p></li>
<li><p><strong>conv_logical</strong> (<em>callable</em><em>, </em><em>optional</em>) – Function that takes an iterable of booleans as input indicating
whether the individual <cite>conv_tol</cite>, <cite>conv_tol_moms</cite>,
<cite>conv_tol_qp</cite> have been satisfied, respectively, and returns a
boolean indicating overall convergence. For example, the
function <cite>all</cite> requires both metrics to be met, and <cite>any</cite>
requires just one. Default value is <cite>all</cite>.</p></li>
<li><p><strong>diis_space</strong> (<em>int</em><em>, </em><em>optional</em>) – Size of the DIIS extrapolation space. Default value is <cite>8</cite>.</p></li>
<li><p><strong>diis_space_qp</strong> (<em>int</em><em>, </em><em>optional</em>) – Size of the DIIS extrapolation space in the quasiparticle
loop. Default value is <cite>8</cite>.</p></li>
<li><p><strong>damping</strong> (<em>float</em><em>, </em><em>optional</em>) – Damping parameter. Default value is <cite>0.0</cite>.</p></li>
<li><p><strong>eta</strong> (<em>float</em><em>, </em><em>optional</em>) – Small value to regularise the self-energy. Default value is
<cite>1e-1</cite>.</p></li>
<li><p><strong>srg</strong> (<em>float</em><em>, </em><em>optional</em>) – If non-zero, use the similarity renormalisation group approach
of Marie and Loos in place of the <cite>eta</cite> regularisation. For
value recommendations refer to their paper (arXiv:2303.05984).
Default value is <cite>0.0</cite>.</p></li>
<li><p><strong>solver</strong> (<a class="reference internal" href="momentGW.html#momentGW.base.BaseGW" title="momentGW.base.BaseGW"><em>BaseGW</em></a><em>, </em><em>optional</em>) – Solver to use to obtain the self-energy. Compatible with any
<cite>BaseGW</cite>-like class. Default value is <cite>momentGW.gw.GW</cite>.</p></li>
<li><p><strong>solver_options</strong> (<em>dict</em><em>, </em><em>optional</em>) – Keyword arguments to pass to the solver. Default value is an
empty <cite>dict</cite>.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.qsgw.qsKUGW.build_static_potential">
<span class="sig-name descname"><span class="pre">build_static_potential</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mo_energy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">se</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.qsgw.qsKUGW.build_static_potential" title="Link to this definition">¶</a></dt>
<dd><p>Build the static potential approximation to the self-energy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mo_energy</strong> (<em>numpy.ndarray</em>) – Molecular orbital energies at each k-point for each spin
channel.</p></li>
<li><p><strong>se</strong> (<em>tuple</em><em> of </em><em>dyson.Lehmann</em>) – Self-energy to approximate at each k-point for each spin
channel.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>se_qp</strong> – Static potential approximation to the self-energy at each
k-point for each spin channel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.qsgw.qsKUGW.check_convergence">
<span class="sig-name descname"><span class="pre">check_convergence</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mo_energy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo_energy_prev</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">th</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">th_prev</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tp_prev</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.qsgw.qsKUGW.check_convergence" title="Link to this definition">¶</a></dt>
<dd><p>Check for convergence, and print a summary of changes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mo_energy</strong> (<em>numpy.ndarray</em>) – Molecular orbital energies at each k-point for each spin
channel.</p></li>
<li><p><strong>mo_energy_prev</strong> (<em>numpy.ndarray</em>) – Molecular orbital energies from the previous iteration at
each k-point for each spin channel.</p></li>
<li><p><strong>th</strong> (<em>numpy.ndarray</em>) – Moments of the occupied self-energy at each k-point for
each spin channel.</p></li>
<li><p><strong>th_prev</strong> (<em>numpy.ndarray</em>) – Moments of the occupied self-energy from the previous
iteration at each k-point for each spin channel.</p></li>
<li><p><strong>tp</strong> (<em>numpy.ndarray</em>) – Moments of the virtual self-energy at each k-point for each
spin channel.</p></li>
<li><p><strong>tp_prev</strong> (<em>numpy.ndarray</em>) – Moments of the virtual self-energy from the previous
iteration at each k-point for each spin channel.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>conv</strong> – Convergence flag.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.qsgw.qsKUGW.name">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">name</span></span><a class="headerlink" href="#momentGW.pbc.uhf.qsgw.qsKUGW.name" title="Link to this definition">¶</a></dt>
<dd><p>Get the method name.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.qsgw.qsKUGW.project_basis">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">project_basis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ovlp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.qsgw.qsKUGW.project_basis" title="Link to this definition">¶</a></dt>
<dd><p>Project a matrix from one basis to another.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>matrix</strong> (<em>numpy.ndarray</em><em> or </em><em>tuple</em><em> of </em><em>dyson.Lehmann</em>) – Matrix to project at each k-point for each spin channel. Can
also be a tuple of <cite>dyson.Lehmann</cite> objects, in which case the
<cite>couplings</cite> attributes are projected.</p></li>
<li><p><strong>ovlp</strong> (<em>numpy.ndarray</em>) – Overlap matrix in the shared (AO) basis at each k-point.</p></li>
<li><p><strong>mo1</strong> (<em>numpy.ndarray</em>) – First basis, rotates from the shared (AO) basis into the
basis of <cite>matrix</cite> at each k-point for each spin channel.</p></li>
<li><p><strong>mo2</strong> (<em>numpy.ndarray</em>) – Second basis, rotates from the shared (AO) basis into the
desired basis of the output at each k-point for each spin
channel.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>proj</strong> – Matrix projected into the desired basis at each k-point
for each spin channel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray or tuple of dyson.Lehmann</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.qsgw.qsKUGW.self_energy_to_moments">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">self_energy_to_moments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">se</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nmom_max</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.qsgw.qsKUGW.self_energy_to_moments" title="Link to this definition">¶</a></dt>
<dd><p>Return the hole and particle moments for a self-energy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>se</strong> (<em>tuple</em><em> of </em><em>dyson.Lehmann</em>) – Self-energy to compute the moments of at each k-point
for each spin channel.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>th</strong> (<em>numpy.ndarray</em>) – Hole moments at each k-point for each spin channel.</p></li>
<li><p><strong>tp</strong> (<em>numpy.ndarray</em>) – Particle moments at each k-point for each spin channel.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.qsgw.qsKUGW.solver">
<span class="sig-name descname"><span class="pre">solver</span></span><a class="headerlink" href="#momentGW.pbc.uhf.qsgw.qsKUGW.solver" title="Link to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#momentGW.pbc.uhf.gw.KUGW" title="momentGW.pbc.uhf.gw.KUGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">KUGW</span></code></a></p>
</dd></dl>

</dd></dl>

</section>
<section id="module-momentGW.pbc.uhf.scgw">
<span id="momentgw-pbc-uhf-scgw-module"></span><h2>momentGW.pbc.uhf.scgw module<a class="headerlink" href="#module-momentGW.pbc.uhf.scgw" title="Link to this heading">¶</a></h2>
<p>Spin-unrestricted self-consistent GW via self-energy moment constraints
for periodic systems.</p>
<dl class="py class">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.scgw.scKUGW">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">momentGW.pbc.uhf.scgw.</span></span><span class="sig-name descname"><span class="pre">scKUGW</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mf</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.scgw.scKUGW" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#momentGW.pbc.uhf.gw.KUGW" title="momentGW.pbc.uhf.gw.KUGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">KUGW</span></code></a>, <a class="reference internal" href="momentGW.pbc.html#momentGW.pbc.scgw.scKGW" title="momentGW.pbc.scgw.scKGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">scKGW</span></code></a>, <a class="reference internal" href="momentGW.uhf.html#momentGW.uhf.scgw.scUGW" title="momentGW.uhf.scgw.scUGW"><code class="xref py py-class docutils literal notranslate"><span class="pre">scUGW</span></code></a></p>
<p>Spin-unrestricted self-consistent GW via self-energy moment
constraints for periodic systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mf</strong> (<em>pyscf.pbc.scf.KSCF</em>) – PySCF periodic mean-field class.</p></li>
<li><p><strong>diagonal_se</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, use a diagonal approximation in the self-energy.
Default value is <cite>False</cite>.</p></li>
<li><p><strong>polarizability</strong> (<em>str</em><em>, </em><em>optional</em>) – Type of polarizability to use, can be one of <cite>(“drpa”,
“drpa-exact”, “dtda”, “thc-dtda”). Default value is `”drpa”</cite>.</p></li>
<li><p><strong>npoints</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of numerical integration points. Default value is <cite>48</cite>.</p></li>
<li><p><strong>optimise_chempot</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, optimise the chemical potential by shifting the
position of the poles in the self-energy relative to those in
the Green’s function. Default value is <cite>False</cite>.</p></li>
<li><p><strong>fock_loop</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, self-consistently renormalise the density matrix
according to the updated Green’s function. Default value is
<cite>False</cite>.</p></li>
<li><p><strong>fock_opts</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary of options passed to the Fock loop. For more details
see <cite>momentGW.fock</cite>.</p></li>
<li><p><strong>compression</strong> (<em>str</em><em>, </em><em>optional</em>) – Blocks of the ERIs to use as a metric for compression. Can be
one or more of <cite>(“oo”, “ov”, “vv”, “ia”)</cite> which can be passed as
a comma-separated string. <cite>“oo”</cite>, <cite>“ov”</cite> and <cite>“vv”</cite> refer to
compression on the initial ERIs, whereas <cite>“ia”</cite> refers to
compression on the ERIs entering RPA, which may change under a
self-consistent scheme. Default value is <cite>“ia”</cite>.</p></li>
<li><p><strong>compression_tol</strong> (<em>float</em><em>, </em><em>optional</em>) – Tolerance for the compression. Default value is <cite>1e-10</cite>.</p></li>
<li><p><strong>thc_opts</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary of options to be used for THC calculations. Current
implementation requires a filepath to import the THC integrals.</p></li>
<li><p><strong>fc</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, apply finite size corrections. Default value is
<cite>False</cite>.</p></li>
<li><p><strong>g0</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, do not self-consistently update the eigenvalues in
the Green’s function. Default value is <cite>False</cite>.</p></li>
<li><p><strong>w0</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite>, do not self-consistently update the eigenvalues in
the screened Coulomb interaction. Default value is <cite>False</cite>.</p></li>
<li><p><strong>max_cycle</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum number of iterations. Default value is <cite>50</cite>.</p></li>
<li><p><strong>conv_tol</strong> (<em>float</em><em>, </em><em>optional</em>) – Convergence threshold in the change in the HOMO and LUMO.
Default value is <cite>1e-8</cite>.</p></li>
<li><p><strong>conv_tol_moms</strong> (<em>float</em><em>, </em><em>optional</em>) – Convergence threshold in the change in the moments. Default
value is <cite>1e-8</cite>.</p></li>
<li><p><strong>diis_space</strong> (<em>int</em><em>, </em><em>optional</em>) – Size of the DIIS extrapolation space. Default value is <cite>8</cite>.</p></li>
<li><p><strong>damping</strong> (<em>float</em><em>, </em><em>optional</em>) – Damping parameter. Default value is <cite>0.0</cite>.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.scgw.scKUGW.check_convergence">
<span class="sig-name descname"><span class="pre">check_convergence</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mo_energy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo_energy_prev</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">th</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">th_prev</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tp_prev</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.scgw.scKUGW.check_convergence" title="Link to this definition">¶</a></dt>
<dd><p>Check for convergence, and print a summary of changes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mo_energy</strong> (<em>numpy.ndarray</em>) – Molecular orbital energies at each k-point for each spin
channel.</p></li>
<li><p><strong>mo_energy_prev</strong> (<em>numpy.ndarray</em>) – Molecular orbital energies from the previous iteration at
each k-point for each spin channel.</p></li>
<li><p><strong>th</strong> (<em>numpy.ndarray</em>) – Moments of the occupied self-energy at each k-point for
each spin channel.</p></li>
<li><p><strong>th_prev</strong> (<em>numpy.ndarray</em>) – Moments of the occupied self-energy from the previous
iteration at each k-point for each spin channel.</p></li>
<li><p><strong>tp</strong> (<em>numpy.ndarray</em>) – Moments of the virtual self-energy at each k-point for each
spin channel.</p></li>
<li><p><strong>tp_prev</strong> (<em>numpy.ndarray</em>) – Moments of the virtual self-energy from the previous
iteration at each k-point for each spin channel.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>conv</strong> – Convergence flag.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.scgw.scKUGW.name">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">name</span></span><a class="headerlink" href="#momentGW.pbc.uhf.scgw.scKUGW.name" title="Link to this definition">¶</a></dt>
<dd><p>Get the method name.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.scgw.scKUGW.remove_unphysical_poles">
<span class="sig-name descname"><span class="pre">remove_unphysical_poles</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gf</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.scgw.scKUGW.remove_unphysical_poles" title="Link to this definition">¶</a></dt>
<dd><p>Remove unphysical poles from the Green’s function to stabilise
iterations, according to the threshold <cite>self.weight_tol</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>gf</strong> (<em>tuple</em><em> of </em><em>tuple</em><em> of </em><em>dyson.Lehmann</em>) – Green’s function at each k-point for each spin channel.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>gf_out</strong> – Green’s function at each k-point for each spin channel, with
potentially fewer poles.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of tuple of dyson.Lehmann</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-momentGW.pbc.uhf.tda">
<span id="momentgw-pbc-uhf-tda-module"></span><h2>momentGW.pbc.uhf.tda module<a class="headerlink" href="#module-momentGW.pbc.uhf.tda" title="Link to this heading">¶</a></h2>
<p>Construct TDA moments with periodic boundary conditions and unrestricted
references.</p>
<dl class="py class">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.tda.dTDA">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">momentGW.pbc.uhf.tda.</span></span><span class="sig-name descname"><span class="pre">dTDA</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nmom_max</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">integrals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo_energy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo_occ</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.tda.dTDA" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="momentGW.pbc.html#momentGW.pbc.tda.dTDA" title="momentGW.pbc.tda.dTDA"><code class="xref py py-class docutils literal notranslate"><span class="pre">dTDA</span></code></a>, <a class="reference internal" href="momentGW.uhf.html#momentGW.uhf.tda.dTDA" title="momentGW.uhf.tda.dTDA"><code class="xref py py-class docutils literal notranslate"><span class="pre">dTDA</span></code></a></p>
<p>Compute the self-energy moments using dTDA and numerical
integration with periodic boundary conditions and unrestricted
references.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gw</strong> (<a class="reference internal" href="#momentGW.pbc.uhf.base.BaseKUGW" title="momentGW.pbc.uhf.base.BaseKUGW"><em>BaseKUGW</em></a>) – GW object.</p></li>
<li><p><strong>nmom_max</strong> (<em>int</em>) – Maximum moment number to calculate.</p></li>
<li><p><strong>integrals</strong> (<a class="reference internal" href="#momentGW.pbc.uhf.ints.KUIntegrals" title="momentGW.pbc.uhf.ints.KUIntegrals"><em>KUIntegrals</em></a>) – Integrals object.</p></li>
<li><p><strong>mo_energy</strong> (<em>dict</em><em>, </em><em>optional</em>) – Molecular orbital energies at each k-point for each spin channel.
Keys are “g” and “w” for the Green’s function and screened
Coulomb interaction, respectively. If <cite>None</cite>, use <cite>gw.mo_energy</cite>
for both. Default value is <cite>None</cite>.</p></li>
<li><p><strong>mo_occ</strong> (<em>dict</em><em>, </em><em>optional</em>) – Molecular orbital occupancies at each k-point for each spin
channel. Keys are “g” and “w” for the Green’s function and
screened Coulomb interaction, respectively. If <cite>None</cite>, use
<cite>gw.mo_occ</cite> for both. Default value is <cite>None</cite>.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.tda.dTDA.build_dd_moments">
<span class="sig-name descname"><span class="pre">build_dd_moments</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.tda.dTDA.build_dd_moments" title="Link to this definition">¶</a></dt>
<dd><p>Build the moments of the density-density response.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>moments</strong> – Moments of the density-density response at each k-point
for each spin channel.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.tda.dTDA.build_se_moments">
<span class="sig-name descname"><span class="pre">build_se_moments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">moments_dd</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.tda.dTDA.build_se_moments" title="Link to this definition">¶</a></dt>
<dd><p>Build the moments of the self-energy via convolution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>moments_dd</strong> (<em>numpy.ndarray</em>) – Moments of the density-density response at each k-point.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>moments_occ</strong> (<em>numpy.ndarray</em>) – Moments of the occupied self-energy at each k-point for each
spin channel.</p></li>
<li><p><strong>moments_vir</strong> (<em>numpy.ndarray</em>) – Moments of the virtual self-energy at each k-point for each
spin channel.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.tda.dTDA.convolve">
<span class="sig-name descname"><span class="pre">convolve</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">eta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo_energy_g</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mo_occ_g</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.tda.dTDA.convolve" title="Link to this definition">¶</a></dt>
<dd><p>Handle the convolution of the moments of the Green’s function
and screened Coulomb interaction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>eta</strong> (<em>numpy.ndarray</em>) – Moments of the density-density response partly transformed
into moments of the screened Coulomb interaction, at each
k-point for each spin channel.</p></li>
<li><p><strong>mo_energy_g</strong> (<em>numpy.ndarray</em><em>, </em><em>optional</em>) – Energies of the Green’s function at each k-point for each
spin channel. If <cite>None</cite>, use <cite>self.mo_energy_g</cite>. Default
value is <cite>None</cite>.</p></li>
<li><p><strong>mo_occ_g</strong> (<em>numpy.ndarray</em><em>, </em><em>optional</em>) – Occupancies of the Green’s function at each k-point for each
spin channel. If <cite>None</cite>, use <cite>self.mo_occ_g</cite>. Default value
is <cite>None</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>moments_occ</strong> (<em>numpy.ndarray</em>) – Moments of the occupied self-energy at each k-point for each
spin channel.</p></li>
<li><p><strong>moments_vir</strong> (<em>numpy.ndarray</em>) – Moments of the virtual self-energy at each k-point for each
spin channel.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.tda.dTDA.kernel">
<span class="sig-name descname"><span class="pre">kernel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exact</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#momentGW.pbc.uhf.tda.dTDA.kernel" title="Link to this definition">¶</a></dt>
<dd><p>Run the polarizability calculation to compute moments of the
self-energy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>exact</strong> (<em>bool</em><em>, </em><em>optional</em>) – Has no effect and is only present for compatibility with
<cite>dRPA</cite>. Default value is <cite>False</cite>.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>moments_occ</strong> (<em>numpy.ndarray</em>) – Moments of the occupied self-energy at each k-point for each
spin channel.</p></li>
<li><p><strong>moments_vir</strong> (<em>numpy.ndarray</em>) – Moments of the virtual self-energy at each k-point for each
spin channel.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="momentGW.pbc.uhf.tda.dTDA.nov">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">nov</span></span><a class="headerlink" href="#momentGW.pbc.uhf.tda.dTDA.nov" title="Link to this definition">¶</a></dt>
<dd><p>Number of ov states in the screened Coulomb interaction.</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-momentGW.pbc.uhf">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-momentGW.pbc.uhf" title="Link to this heading">¶</a></h2>
<p>Methods for periodic systems with unrestricted references.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">momentGW</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Oliver J. Backhouse.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/api/momentGW.pbc.uhf.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>